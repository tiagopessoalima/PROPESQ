<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Cursos de P√≥s-Gradua√ß√£o - IFPE</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #005c80;
            --secondary-color: #009ee3;
            --accent-color: #ff6b00;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --card-height: 140px;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #ffffff;
            color: #333;
            height: 100vh;
            overflow: hidden;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        header {
            background-color: var(--primary-color);
            color: white;
            padding: 1rem;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .search-container {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        .search-group {
            flex: 1;
            min-width: 200px;
            position: relative;
        }
        
        /* Estilo melhorado para os comboboxes */
        .search-group label {
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            display: block;
            color: white;
            font-weight: 500;
        }
        
        .search-group select {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: white;
            color: #333;
            font-size: 0.9rem;
            height: 38px;
            cursor: pointer;
        }
        
        .search-group select:focus {
            outline: none;
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 2px rgba(0, 158, 227, 0.2);
        }
        
        /* Estilo para os filtros com checkboxes */
        .filter-checkbox-container {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            margin-top: 2px;
        }
        
        .filter-checkbox-container.show {
            display: block;
        }
        
        .filter-option {
            padding: 8px 12px;
            display: flex;
            align-items: center;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .filter-option:last-child {
            border-bottom: none;
        }
        
        .filter-option:hover {
            background-color: #f5f5f5;
        }
        
        .filter-option input {
            margin-right: 8px;
            width: auto;
            height: auto;
        }
        
        .filter-option label {
            cursor: pointer;
            margin: 0;
            font-size: 0.9rem;
            flex: 1;
            color: #333;
        }
        
        .filter-header {
            display: flex;
            justify-content: space-between;
            padding: 8px 12px;
            background-color: var(--secondary-color);
            border-bottom: 1px solid #ddd;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        .filter-select-all {
            color: var(--light-color);
            cursor: pointer;
            font-weight: normal;
        }
        
        .filter-select-all:hover {
            text-decoration: underline;
        }
        
        .selected-count {
            font-size: 0.8rem;
            color: #e0e0e0;
            margin-top: 4px;
        }
        
        .main-content {
            flex: 1;
            padding: 1rem;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background-color: #f8f9fa;
        }
        
        .view-toggle {
            display: flex;
            margin-bottom: 1rem;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .view-toggle button {
            flex: 1;
            padding: 0.5rem;
            border: none;
            background: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 500;
        }
        
        .view-toggle button.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        /* Estilos para os cards de indicadores */
        .indicators-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .indicator-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            height: var(--card-height);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            border-left: 4px solid var(--secondary-color);
        }
        
        .indicator-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        .indicator-card.active {
            border: 2px solid var(--secondary-color);
            background-color: rgba(0, 158, 227, 0.05);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .card-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .card-icon {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            background-color: rgba(0, 92, 128, 0.1);
            color: var(--primary-color);
        }
        
        .card-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin: auto 0;
            color: var(--dark-color);
        }
        
        .card-comparison {
            font-size: 0.8rem;
            color: #666;
            margin-top: auto;
        }
        
        .card-comparison.positive {
            color: #28a745;
        }
        
        .card-comparison.negative {
            color: #dc3545;
        }
        
        /* Estilo para as barras de distribui√ß√£o */
        .area-distribution {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .area-bar {
            flex: 1;
            height: 8px;
            background-color: #e9ecef;
            border-radius: 4px;
            overflow: hidden;
        }
        
        .area-progress {
            height: 100%;
            background-color: var(--secondary-color);
            border-radius: 4px;
        }
        
        .area-percentage {
            font-size: 0.75rem;
            font-weight: 600;
            color: var(--primary-color);
            min-width: 40px;
            text-align: right;
        }
        
        .map-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            height: calc(100% - var(--card-height) - 1rem);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
            background-color: white;
        }
        
        .table-container {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
            height: calc(100% - var(--card-height) - 1rem);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
            background-color: white;
        }
        
        #map {
            height: 100%;
            width: 100%;
        }
        
        #courses-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        #courses-table th, #courses-table td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        #courses-table th {
            background-color: var(--primary-color);
            color: white;
            position: sticky;
            top: 0;
            cursor: pointer;
            user-select: none;
        }
        
        #courses-table th:hover {
            background-color: var(--secondary-color);
        }
        
        #courses-table th.sort-asc::after {
            content: " ‚ñ≤";
            font-size: 0.8em;
        }
        
        #courses-table th.sort-desc::after {
            content: " ‚ñº";
            font-size: 0.8em;
        }
        
        #courses-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        #courses-table tr:hover {
            background-color: #f0f0f0;
        }
        
        .table-scroll {
            max-height: 100%;
            overflow-y: auto;
        }
        
        input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 0.25rem;
            height: 38px;
            box-sizing: border-box;
            font-size: 0.9rem;
        }
        
        .legend {
            padding: 6px 8px;
            background: white;
            background: rgba(255,255,255,0.9);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 5px;
            line-height: 18px;
            color: #555;
        }
        
        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
            border-radius: 50%;
        }
        
        h1, h2, h3 {
            margin-top: 0;
        }
        
        .leaflet-popup-content {
            max-width: 300px;
        }
        
        .popup-course-list {
            max-height: 200px;
            overflow-y: auto;
            margin: 0;
            padding-left: 1rem;
        }
        
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100%;
            font-size: 1.2rem;
            background-color: white;
        }
        
        .no-results {
            padding: 1rem;
            text-align: center;
            font-style: italic;
            color: #777;
        }
        
        .btn-site {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 0.4rem 0.8rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background-color 0.2s;
        }
        
        .btn-site:hover {
            background-color: var(--primary-color);
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }
        
        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .close:hover {
            color: black;
        }
        
        .area-list {
            margin-top: 1rem;
        }
        
        .area-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .area-name {
            font-weight: 500;
        }
        
        .area-count {
            color: var(--primary-color);
            font-weight: 600;
        }
        
        .chart-container {
            margin-top: 1rem;
            height: 300px;
            position: relative;
        }
        
        @media (max-width: 768px) {
            .search-container {
                flex-direction: column;
            }
            
            .search-group {
                min-width: 100%;
            }
            
            .view-toggle {
                flex-direction: column;
            }
            
            .indicators-container {
                grid-template-columns: 1fr;
            }
            
            .map-container, .table-container {
                height: calc(55% - var(--card-height) - 1rem);
            }
            
            .modal-content {
                width: 95%;
                margin: 5% auto;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.2/papaparse.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>Mapa de Cursos de P√≥s-Gradua√ß√£o - IFPE</h1>
            <div class="search-container">
                <div class="search-group">
                    <label for="search">Pesquisar curso:</label>
                    <input type="text" id="search" placeholder="Digite o nome do curso...">
                </div>
                
                <div class="search-group">
                    <label for="area">Filtrar por √°rea:</label>
                    <div class="filter-select-wrapper">
                        <select id="area" multiple style="display: none;">
                            <option value="">Todas as √°reas</option>
                        </select>
                        <div class="filter-checkbox-container" id="area-checkbox-container">
                            <div class="filter-header">
                                <span>Selecionar √°reas</span>
                                <span class="filter-select-all" data-target="area">Selecionar todas</span>
                            </div>
                            <div class="filter-options-list" id="area-options"></div>
                        </div>
                    </div>
                    <div class="selected-count" id="area-selected-count">Nenhuma selecionada</div>
                </div>
                
                <div class="search-group">
                    <label for="type">Filtrar por tipo:</label>
                    <div class="filter-select-wrapper">
                        <select id="type" multiple style="display: none;">
                            <option value="">Todos os tipos</option>
                        </select>
                        <div class="filter-checkbox-container" id="type-checkbox-container">
                            <div class="filter-header">
                                <span>Selecionar tipos</span>
                                <span class="filter-select-all" data-target="type">Selecionar todos</span>
                            </div>
                            <div class="filter-options-list" id="type-options"></div>
                        </div>
                    </div>
                    <div class="selected-count" id="type-selected-count">Nenhuma selecionada</div>
                </div>
                
                <div class="search-group">
                    <label for="region">Filtrar por regi√£o:</label>
                    <div class="filter-select-wrapper">
                        <select id="region" multiple style="display: none;">
                            <option value="">Todas as regi√µes</option>
                        </select>
                        <div class="filter-checkbox-container" id="region-checkbox-container">
                            <div class="filter-header">
                                <span>Selecionar regi√µes</span>
                                <span class="filter-select-all" data-target="region">Selecionar todas</span>
                            </div>
                            <div class="filter-options-list" id="region-options"></div>
                        </div>
                    </div>
                    <div class="selected-count" id="region-selected-count">Nenhuma selecionada</div>
                </div>
            </div>
        </header>
        
        <main class="main-content">
            <div class="view-toggle">
                <button id="map-view-btn" class="active">Visualiza√ß√£o do Mapa</button>
                <button id="table-view-btn">Visualiza√ß√£o em Tabela</button>
            </div>
            
            <!-- Cards de indicadores (reordenados conforme solicitado) -->
            <div class="indicators-container" id="indicators-container">
                <!-- Primeiro card: Campus -->
                <div class="indicator-card" id="campus-distribution-card">
                    <div class="card-header">
                        <div class="card-title">Distribui√ß√£o por Campus</div>
                        <div class="card-icon">üè´</div>
                    </div>
                    <div class="card-value" id="top-campus">-</div>
                    <div class="area-distribution">
                        <div class="area-bar">
                            <div class="area-progress" id="campus-progress" style="width: 0%"></div>
                        </div>
                        <div class="area-percentage" id="campus-percentage">0%</div>
                    </div>
                    <div class="card-comparison" id="campus-count">Clique para ver gr√°fico</div>
                </div>
                
                <!-- Segundo card: Regi√£o -->
                <div class="indicator-card" id="regional-courses-card">
                    <div class="card-header">
                        <div class="card-title">Distribui√ß√£o por Regi√£o</div>
                        <div class="card-icon">üåé</div>
                    </div>
                    <div class="card-value" id="top-region">-</div>
                    <div class="area-distribution">
                        <div class="area-bar">
                            <div class="area-progress" id="region-progress" style="width: 0%"></div>
                        </div>
                        <div class="area-percentage" id="region-percentage">0%</div>
                    </div>
                    <div class="card-comparison" id="region-count">Clique para ver gr√°fico</div>
                </div>
                
                <!-- Terceiro card: √Årea -->
                <div class="indicator-card" id="area-distribution-card">
                    <div class="card-header">
                        <div class="card-title">Distribui√ß√£o por √Årea</div>
                        <div class="card-icon">üìö</div>
                    </div>
                    <div class="card-value" id="top-area">-</div>
                    <div class="area-distribution">
                        <div class="area-bar">
                            <div class="area-progress" id="area-progress" style="width: 0%"></div>
                        </div>
                        <div class="area-percentage" id="area-percentage">0%</div>
                    </div>
                    <div class="card-comparison" id="area-count">Clique para ver gr√°fico</div>
                </div>
                
                <!-- Quarto card: Tipo -->
                <div class="indicator-card" id="type-distribution-card">
                    <div class="card-header">
                        <div class="card-title">Distribui√ß√£o por Tipo</div>
                        <div class="card-icon">üìã</div>
                    </div>
                    <div class="card-value" id="type-distribution">-</div>
                    <div class="area-distribution">
                        <div class="area-bar">
                            <div class="area-progress" id="type-progress" style="width: 0%"></div>
                        </div>
                        <div class="area-percentage" id="type-percentage">0%</div>
                    </div>
                    <div class="card-comparison" id="type-count">Clique para ver gr√°fico</div>
                </div>
            </div>
            
            <div class="map-container">
                <div id="map">
                    <div class="loading">Carregando mapa e dados...</div>
                </div>
            </div>
            
            <div class="table-container" id="table-container">
                <div class="table-scroll">
                    <table id="courses-table">
                        <thead>
                            <tr>
                                <th data-sort="name">Curso</th>
                                <th data-sort="type">Tipo</th>
                                <th data-sort="area">√Årea</th>
                                <th data-sort="campus">Campus</th>
                                <th data-sort="region">Regi√£o</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody id="courses-table-body">
                            </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal para distribui√ß√£o por campus -->
    <div id="campus-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Distribui√ß√£o de Cursos por Campus</h2>
            <div class="chart-container">
                <canvas id="campus-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Modal para distribui√ß√£o por regi√£o -->
    <div id="region-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Distribui√ß√£o de Cursos por Regi√£o</h2>
            <div class="chart-container">
                <canvas id="region-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Modal para distribui√ß√£o por √°rea -->
    <div id="area-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Distribui√ß√£o de Cursos por √Årea</h2>
            <div class="chart-container">
                <canvas id="area-chart"></canvas>
            </div>
        </div>
    </div>

    <!-- Modal para distribui√ß√£o por tipo -->
    <div id="type-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Distribui√ß√£o de Cursos por Tipo</h2>
            <div class="chart-container">
                <canvas id="type-chart"></canvas>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script>
        // Vari√°veis globais
        let map, markers = [], currentView = 'map', pernambucoLayer = null;
        let allCoursesCount = 0;
        let currentSort = { column: null, direction: 'asc' };
        let areaDistributionData = {};
        let typeDistributionData = {};
        let regionalDistributionData = {};
        let campusDistributionData = {};
        let campiData = [];

        // Inst√¢ncias dos gr√°ficos
        let typeChart = null;
        let regionChart = null;
        let areaChart = null;
        let campusChart = null;

        document.addEventListener('DOMContentLoaded', () => {
            fetch('https://raw.githubusercontent.com/tiagopessoalima/PROPESQ/refs/heads/main/mapa-cursos-posgraduacao-ifpe/cursos_pos_graduacao.csv')
                .then(response => response.text())
                .then(csvText => {
                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: (results) => {
                            iniciarDashboard(results.data);
                        }
                    });
                })
                .catch(error => {
                    console.error("Erro ao carregar o arquivo CSV:", error);
                    document.querySelector('.loading').textContent = 'Falha ao carregar dados. Verifique o console.';
                });
        });

        function iniciarDashboard(cursosDoCsv) {
            // 1. Processar os dados do CSV para o formato aninhado que o script espera
            const campi = {};
            cursosDoCsv.forEach(curso => {
                const nomeCampus = curso.Campus_Nome;
                if (!campi[nomeCampus]) {
                    campi[nomeCampus] = {
                        name: nomeCampus,
                        location: curso.Campus_Localizacao,
                        coordinates: [parseFloat(curso.Campus_Latitude), parseFloat(curso.Campus_Longitude)],
                        region: curso.Campus_Regiao,
                        courses: []
                    };
                }
                campi[nomeCampus].courses.push({
                    name: curso.Curso_Nome,
                    type: curso.Curso_Tipo,
                    area: curso.Curso_Area,
                    url: curso.Curso_URL
                });
            });
            campiData = Object.values(campi); 

            // 2. Agora que os dados est√£o prontos, execute o resto do c√≥digo
            inicializarMapaEComponentes();
        }

        function inicializarMapaEComponentes() {
            const loadingElement = document.querySelector('.loading');
            if (loadingElement) {
                loadingElement.remove();
            }
            
            // Preencher os comboboxes
            initializeSelectFilters();
            
            map = L.map('map').setView([-8.38, -37.66], 8);
            
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);
                
            // Carregar o GeoJSON de Pernambuco
            fetch('https://raw.githubusercontent.com/tbrugz/geodata-br/refs/heads/master/geojson/geojs-26-mun.json')
                .then(response => response.json())
                .then(data => {
                    pernambucoLayer = L.geoJSON(data, {
                        style: {
                            color: '#005c80',
                            weight: 2,
                            fillColor: 'rgba(0, 92, 128, 0.1)',
                            fillOpacity: 0.3
                        }
                    }).addTo(map);
                    map.fitBounds(pernambucoLayer.getBounds());
                })
                .catch(error => console.error('Erro ao carregar o GeoJSON de Pernambuco:', error));

            const regionColors = {
                "Metropolitana": "#e41a1c",
                "Zona da Mata": "#377eb8",
                "Agreste": "#4daf4a",
                "Sert√£o": "#984ea3",
                "V√°rios": "#ff7f00"
            };

            allCoursesCount = campiData.reduce((total, campus) => total + campus.courses.length, 0);
            updateIndicators(campiData);

            campiData.forEach(campus => {
                const markerIcon = L.divIcon({
                    className: 'custom-marker',
                    html: `<div style="background-color: ${regionColors[campus.region]}; width: 20px; height: 20px; border-radius: 50%; border: 2px solid white; box-shadow: 0 0 10px rgba(0,0,0,0.5);"></div>`,
                    iconSize: [20, 20],
                    iconAnchor: [10, 10]
                });
                
                const popupContent = `
                    <strong>${campus.name}</strong><br>
                    <em>${campus.location}</em><br>
                    <strong>Cursos (${campus.courses.length}):</strong>
                    <ul class="popup-course-list">
                        ${campus.courses.map(course => `<li>${course.name} (${course.type})</li>`).join('')}
                    </ul>
                `;
                
                const marker = L.marker(campus.coordinates, { icon: markerIcon })
                    .addTo(map)
                    .bindPopup(popupContent);
                
                markers.push({
                    marker: marker,
                    campus: campus
                });
            });

            adjustMapToVisibleMarkers();

            const legend = L.control({ position: 'bottomright' });
            legend.onAdd = function(map) {
                const div = L.DomUtil.create('div', 'legend');
                div.innerHTML = '<h4>Regi√µes</h4>';
                
                for (const region in regionColors) {
                    if (region !== "V√°rios") {
                        div.innerHTML += `<div><i style="background:${regionColors[region]}"></i> ${region}</div>`;
                    }
                }
                
                div.innerHTML += `
                    <div style="margin-top: 10px; border-top: 1px solid #ccc; padding-top: 5px;">
                        <div><i style="background:rgba(0, 92, 128, 0.3); border: 1px solid #005c80;</div>
                    </div>
                `;
                
                return div;
            };
            legend.addTo(map);
            
            populateTable(campiData);
            
            document.getElementById('map-view-btn').addEventListener('click', () => showView('map'));
            document.getElementById('table-view-btn').addEventListener('click', () => showView('table'));
            
            document.querySelectorAll('#courses-table th[data-sort]').forEach(header => {
                header.addEventListener('click', () => sortTable(header.getAttribute('data-sort')));
            });
            
            let filterTimeout;
            document.getElementById('search').addEventListener('input', () => {
                clearTimeout(filterTimeout);
                filterTimeout = setTimeout(applyFilters, 300);
            });
            
            // Configurar eventos para os filtros de checkbox
            setupCheckboxFilters();
            
            window.addEventListener('resize', () => map.invalidateSize());
            
            // Configurar eventos para os cards (agora na nova ordem)
            document.getElementById('campus-distribution-card').addEventListener('click', showCampusModal);
            document.getElementById('regional-courses-card').addEventListener('click', showRegionModal);
            document.getElementById('area-distribution-card').addEventListener('click', showAreaModal);
            document.getElementById('type-distribution-card').addEventListener('click', showTypeModal);
            
            // Configurar eventos para fechar os modais
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                const closeBtn = modal.querySelector('.close');
                closeBtn.addEventListener('click', () => modal.style.display = 'none');
            });
            
            window.addEventListener('click', (event) => {
                modals.forEach(modal => {
                    if (event.target == modal) {
                        modal.style.display = 'none';
                    }
                });
            });
        }

        function setupCheckboxFilters() {
            // Configurar eventos para os filtros de checkbox
            const filterTypes = ['area', 'type', 'region'];
            
            filterTypes.forEach(filterType => {
                const container = document.getElementById(`${filterType}-checkbox-container`);
                const selectElement = document.getElementById(filterType);
                const selectedCountElement = document.getElementById(`${filterType}-selected-count`);
                
                // Mostrar/ocultar o dropdown ao clicar no select
                selectElement.addEventListener('click', (e) => {
                    e.preventDefault();
                    container.classList.toggle('show');
                    
                    // Fechar outros dropdowns abertos
                    filterTypes.forEach(otherType => {
                        if (otherType !== filterType) {
                            document.getElementById(`${otherType}-checkbox-container`).classList.remove('show');
                        }
                    });
                });
                
                // Atualizar contagem de selecionados
                const updateSelectedCount = () => {
                    const selectedOptions = Array.from(selectElement.selectedOptions);
                    const count = selectedOptions.length;
                    
                    if (count === 0) {
                        selectedCountElement.textContent = 'Nenhuma selecionada';
                    } else if (count === 1) {
                        selectedCountElement.textContent = '1 selecionada';
                    } else {
                        selectedCountElement.textContent = `${count} selecionadas`;
                    }
                };
                
                // Inicializar contagem
                updateSelectedCount();
                
                // Atualizar filtros quando houver mudan√ßa
                selectElement.addEventListener('change', () => {
                    updateSelectedCount();
                    applyFilters();
                });
            });
            
            // Fechar dropdowns ao clicar fora
            document.addEventListener('click', (e) => {
                if (!e.target.closest('.filter-select-wrapper')) {
                    document.querySelectorAll('.filter-checkbox-container').forEach(container => {
                        container.classList.remove('show');
                    });
                }
            });
            
            // Configurar bot√µes "Selecionar todas"
            document.querySelectorAll('.filter-select-all').forEach(button => {
                button.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const target = e.target.getAttribute('data-target');
                    const selectElement = document.getElementById(target);
                    const options = Array.from(selectElement.options);
                    
                    // Verificar se j√° est√£o todas selecionadas
                    const allSelected = options.every(option => option.selected || option.value === "");
                    
                    if (allSelected) {
                        // Desselecionar todas (exceto a op√ß√£o "Todas")
                        options.forEach(option => {
                            if (option.value !== "") option.selected = false;
                        });
                    } else {
                        // Selecionar todas
                        options.forEach(option => {
                            if (option.value !== "") option.selected = true;
                        });
                    }
                    
                    // Disparar evento de change
                    const event = new Event('change');
                    selectElement.dispatchEvent(event);
                });
            });
        }

        function initializeSelectFilters() {
            // Extrair op√ß√µes √∫nicas para os filtros
            const areas = new Set();
            const types = new Set();
            const regions = new Set();
            
            campiData.forEach(campus => {
                if (campus.region) regions.add(campus.region);
                campus.courses.forEach(course => {
                    if (course.area) areas.add(course.area);
                    if (course.type) types.add(course.type);
                });
            });
            
            // Preencher combobox de √°reas
            const areaSelect = document.getElementById('area');
            const areaOptionsContainer = document.getElementById('area-options');
            
            Array.from(areas).sort().forEach(area => {
                const option = document.createElement('option');
                option.value = area;
                option.textContent = area;
                areaSelect.appendChild(option);
                
                // Adicionar checkbox
                const checkboxOption = document.createElement('div');
                checkboxOption.className = 'filter-option';
                checkboxOption.innerHTML = `
                    <input type="checkbox" id="area-${area}" value="${area}">
                    <label for="area-${area}">${area}</label>
                `;
                areaOptionsContainer.appendChild(checkboxOption);
                
                // Sincronizar checkbox com select
                const checkbox = checkboxOption.querySelector('input');
                checkbox.addEventListener('change', () => {
                    const optionElement = Array.from(areaSelect.options).find(opt => opt.value === area);
                    if (optionElement) {
                        optionElement.selected = checkbox.checked;
                        const event = new Event('change');
                        areaSelect.dispatchEvent(event);
                    }
                });
            });
            
            // Preencher combobox de tipos
            const typeSelect = document.getElementById('type');
            const typeOptionsContainer = document.getElementById('type-options');
            
            Array.from(types).sort().forEach(type => {
                const option = document.createElement('option');
                option.value = type;
                option.textContent = type;
                typeSelect.appendChild(option);
                
                // Adicionar checkbox
                const checkboxOption = document.createElement('div');
                checkboxOption.className = 'filter-option';
                checkboxOption.innerHTML = `
                    <input type="checkbox" id="type-${type}" value="${type}">
                    <label for="type-${type}">${type}</label>
                `;
                typeOptionsContainer.appendChild(checkboxOption);
                
                // Sincronizar checkbox com select
                const checkbox = checkboxOption.querySelector('input');
                checkbox.addEventListener('change', () => {
                    const optionElement = Array.from(typeSelect.options).find(opt => opt.value === type);
                    if (optionElement) {
                        optionElement.selected = checkbox.checked;
                        const event = new Event('change');
                        typeSelect.dispatchEvent(event);
                    }
                });
            });
            
            // Preencher combobox de regi√µes
            const regionSelect = document.getElementById('region');
            const regionOptionsContainer = document.getElementById('region-options');
            
            Array.from(regions).sort().forEach(region => {
                const option = document.createElement('option');
                option.value = region;
                option.textContent = region;
                regionSelect.appendChild(option);
                
                // Adicionar checkbox
                const checkboxOption = document.createElement('div');
                checkboxOption.className = 'filter-option';
                checkboxOption.innerHTML = `
                    <input type="checkbox" id="region-${region}" value="${region}">
                    <label for="region-${region}">${region}</label>
                `;
                regionOptionsContainer.appendChild(checkboxOption);
                
                // Sincronizar checkbox com select
                const checkbox = checkboxOption.querySelector('input');
                checkbox.addEventListener('change', () => {
                    const optionElement = Array.from(regionSelect.options).find(opt => opt.value === region);
                    if (optionElement) {
                        optionElement.selected = checkbox.checked;
                        const event = new Event('change');
                        regionSelect.dispatchEvent(event);
                    }
                });
            });
            
            // Selecionar todas as op√ß√µes por padr√£o (exceto a op√ß√£o vazia)
            ['area', 'type', 'region'].forEach(filterType => {
                const select = document.getElementById(filterType);
                const options = Array.from(select.options);
                options.forEach(option => {
                    if (option.value !== "") option.selected = true;
                });
                
                // Sincronizar checkboxes
                options.forEach(option => {
                    if (option.value !== "") {
                        const checkbox = document.getElementById(`${filterType}-${option.value}`);
                        if (checkbox) {
                            checkbox.checked = true;
                        }
                    }
                });
                
                // Atualizar contagem
                const selectedCountElement = document.getElementById(`${filterType}-selected-count`);
                const count = options.filter(opt => opt.value !== "").length;
                selectedCountElement.textContent = `${count} selecionadas`;
            });
            
            // Sincronizar selects com checkboxes quando houver mudan√ßa
            ['area', 'type', 'region'].forEach(filterType => {
                const select = document.getElementById(filterType);
                select.addEventListener('change', () => {
                    const options = Array.from(select.options);
                    options.forEach(option => {
                        if (option.value !== "") {
                            const checkbox = document.getElementById(`${filterType}-${option.value}`);
                            if (checkbox) {
                                checkbox.checked = option.selected;
                            }
                        }
                    });
                });
            });
        }

        function getSelectedValues(selectElement) {
            const selectedOptions = Array.from(selectElement.selectedOptions);
            return selectedOptions.map(option => option.value).filter(value => value !== "");
        }

        function adjustMapToVisibleMarkers() {
            const visibleMarkers = markers.filter(item => map.hasLayer(item.marker));
            
            if (visibleMarkers.length === 0) {
                if (pernambucoLayer) {
                    map.fitBounds(pernambucoLayer.getBounds());
                }
                return;
            }

            if (visibleMarkers.length === 1) {
                map.setView(visibleMarkers[0].marker.getLatLng(), 13);
                return;
            }

            const markerGroup = L.featureGroup(visibleMarkers.map(item => item.marker));
            map.fitBounds(markerGroup.getBounds().pad(0.1));
        }

        function populateTable(data) {
            const tableBody = document.getElementById('courses-table-body');
            tableBody.innerHTML = '';
            
            let hasResults = false;
            
            data.forEach(campus => {
                campus.courses.forEach(course => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${course.name}</td>
                        <td>${course.type}</td>
                        <td>${course.area}</td>
                        <td>${campus.name}</td>
                        <td>${campus.region}</td>
                        <td>
                            ${course.url ? 
                                `<button class="btn-site" onclick="window.open('${course.url}', '_blank')">Ver site</button>` : 
                                'N/A'}
                        </td>
                    `;
                    tableBody.appendChild(row);
                    hasResults = true;
                });
            });
            
            if (!hasResults) {
                const noResultsRow = document.createElement('tr');
                noResultsRow.innerHTML = `
                    <td colspan="6" class="no-results">Nenhum curso encontrado com os filtros aplicados.</td>
                `;
                tableBody.appendChild(noResultsRow);
            }
            
            if (currentSort.column) {
                sortTable(currentSort.column, false);
            }
        }
        
        function applyFilters() {
            const searchText = document.getElementById('search').value.toLowerCase();
            const selectedAreas = getSelectedValues(document.getElementById('area'));
            const selectedTypes = getSelectedValues(document.getElementById('type'));
            const selectedRegions = getSelectedValues(document.getElementById('region'));
            
            const filteredCampiData = campiData.map(campus => {
                if (selectedRegions.length > 0 && !selectedRegions.includes(campus.region)) {
                    return null;
                }
                
                const filteredCourses = campus.courses.filter(course => {
                    const matchesSearch = searchText === '' || course.name.toLowerCase().includes(searchText);
                    const matchesArea = selectedAreas.length === 0 || selectedAreas.includes(course.area);
                    const matchesType = selectedTypes.length === 0 || selectedTypes.includes(course.type);
                    return matchesSearch && matchesArea && matchesType;
                });
                
                if (filteredCourses.length > 0) {
                    return { ...campus, courses: filteredCourses };
                }
                
                return null;
            }).filter(campus => campus !== null);
            
            populateTable(filteredCampiData);
            updateIndicators(filteredCampiData);
            
            markers.forEach(item => {
                if (selectedRegions.length > 0 && !selectedRegions.includes(item.campus.region)) {
                    item.marker.remove();
                    return;
                }
                
                const filteredCourses = item.campus.courses.filter(course => {
                    const matchesSearch = searchText === '' || course.name.toLowerCase().includes(searchText);
                    const matchesArea = selectedAreas.length === 0 || selectedAreas.includes(course.area);
                    const matchesType = selectedTypes.length === 0 || selectedTypes.includes(course.type);
                    return matchesSearch && matchesArea && matchesType;
                });
                
                if (filteredCourses.length > 0) {
                    const popupContent = `
                        <strong>${item.campus.name}</strong><br>
                        <em>${item.campus.location}</em><br>
                        <strong>Cursos (${filteredCourses.length}):</strong>
                        <ul class="popup-course-list">
                            ${filteredCourses.map(course => `<li>${course.name} (${course.type})</li>`).join('')}
                        </ul>
                    `;
                    item.marker.setPopupContent(popupContent);
                    if (!map.hasLayer(item.marker)) {
                        item.marker.addTo(map);
                    }
                } else {
                    item.marker.remove();
                }
            });

            if (currentView === 'map') {
                setTimeout(adjustMapToVisibleMarkers, 100);
            }
        }
        
        function showView(view) {
            currentView = view;
            
            if (view === 'map') {
                document.getElementById('map-view-btn').classList.add('active');
                document.getElementById('table-view-btn').classList.remove('active');
                document.querySelector('.map-container').style.display = 'block';
                document.getElementById('table-container').style.display = 'none';
                setTimeout(() => { map.invalidateSize(); adjustMapToVisibleMarkers(); }, 100);
            } else {
                document.getElementById('map-view-btn').classList.remove('active');
                document.getElementById('table-view-btn').classList.add('active');
                document.querySelector('.map-container').style.display = 'none';
                document.getElementById('table-container').style.display = 'block';
            }
        }
        
        function updateIndicators(data) {
            const totalCourses = data.reduce((total, campus) => total + campus.courses.length, 0);
            
            // Calcular distribui√ß√£o por √°rea
            areaDistributionData = {};
            data.forEach(campus => {
                campus.courses.forEach(course => {
                    areaDistributionData[course.area] = (areaDistributionData[course.area] || 0) + 1;
                });
            });
            
            // Calcular distribui√ß√£o por tipo
            typeDistributionData = {};
            data.forEach(campus => {
                campus.courses.forEach(course => {
                    typeDistributionData[course.type] = (typeDistributionData[course.type] || 0) + 1;
                });
            });
            
            // Calcular distribui√ß√£o regional
            regionalDistributionData = {};
            data.forEach(campus => {
                regionalDistributionData[campus.region] = (regionalDistributionData[campus.region] || 0) + campus.courses.length;
            });
            
            // Calcular distribui√ß√£o por campus
            campusDistributionData = {};
            data.forEach(campus => {
                campusDistributionData[campus.name] = (campusDistributionData[campus.name] || 0) + campus.courses.length;
            });
            
            // Encontrar a √°rea com mais cursos
            let topArea = "-";
            let maxAreaCount = 0;
            for (const area in areaDistributionData) {
                if (areaDistributionData[area] > maxAreaCount) {
                    maxAreaCount = areaDistributionData[area];
                    topArea = area;
                }
            }
            
            // Encontrar a regi√£o com mais cursos
            let topRegion = "-";
            let maxRegionCount = 0;
            for (const region in regionalDistributionData) {
                if (regionalDistributionData[region] > maxRegionCount) {
                    maxRegionCount = regionalDistributionData[region];
                    topRegion = region;
                }
            }
            
            // Encontrar o campus com mais cursos
            let topCampus = "-";
            let maxCampusCount = 0;
            for (const campus in campusDistributionData) {
                if (campusDistributionData[campus] > maxCampusCount) {
                    maxCampusCount = campusDistributionData[campus];
                    topCampus = campus;
                }
            }
            
            // Encontrar o tipo com mais cursos
            let topType = "-";
            let maxTypeCount = 0;
            for (const type in typeDistributionData) {
                if (typeDistributionData[type] > maxTypeCount) {
                    maxTypeCount = typeDistributionData[type];
                    topType = type;
                }
            }
            
            // Calcular percentuais
            const topAreaPercentage = totalCourses > 0 ? ((maxAreaCount / totalCourses) * 100).toFixed(1) : 0;
            const topRegionPercentage = totalCourses > 0 ? ((maxRegionCount / totalCourses) * 100).toFixed(1) : 0;
            const topCampusPercentage = totalCourses > 0 ? ((maxCampusCount / totalCourses) * 100).toFixed(1) : 0;
            const topTypePercentage = totalCourses > 0 ? ((maxTypeCount / totalCourses) * 100).toFixed(1) : 0;
            
            // Atualizar indicadores
            // Campus
            document.getElementById('top-campus').textContent = `Top: ${topCampus}`;
            document.getElementById('campus-progress').style.width = `${topCampusPercentage}%`;
            document.getElementById('campus-percentage').textContent = `${topCampusPercentage}%`;
            document.getElementById('campus-count').textContent = 
                maxCampusCount > 0 ? `${maxCampusCount} cursos (clique para detalhes)` : "Nenhum curso";
            
            // Regi√£o
            document.getElementById('top-region').textContent = `Top: ${topRegion}`;
            document.getElementById('region-progress').style.width = `${topRegionPercentage}%`;
            document.getElementById('region-percentage').textContent = `${topRegionPercentage}%`;
            document.getElementById('region-count').textContent = 
                `${Object.keys(regionalDistributionData).length} regi√µes (clique para detalhes)`;
            
            // √Årea
            document.getElementById('top-area').textContent = `Top: ${topArea}`;
            document.getElementById('area-progress').style.width = `${topAreaPercentage}%`;
            document.getElementById('area-percentage').textContent = `${topAreaPercentage}%`;
            document.getElementById('area-count').textContent = 
                maxAreaCount > 0 ? `${maxAreaCount} cursos (clique para detalhes)` : "Nenhum curso";
            
            // Tipo
            document.getElementById('type-distribution').textContent = `Top: ${topType}`;
            document.getElementById('type-progress').style.width = `${topTypePercentage}%`;
            document.getElementById('type-percentage').textContent = `${topTypePercentage}%`;
            document.getElementById('type-count').textContent = 
                `${Object.keys(typeDistributionData).length} tipos (clique para detalhes)`;
        }
        
        function sortTable(column, updateHeader = true) {
            const tbody = document.getElementById('courses-table-body');
            const rows = Array.from(tbody.querySelectorAll('tr'));
            
            if (updateHeader && currentSort.column === column) {
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else if (updateHeader) {
                currentSort.column = column;
                currentSort.direction = 'asc';
            }
            
            document.querySelectorAll('#courses-table th').forEach(th => {
                th.classList.remove('sort-asc', 'sort-desc');
            });
            
            if (updateHeader) {
                const currentHeader = document.querySelector(`#courses-table th[data-sort="${column}"]`);
                if (currentHeader) {
                    currentHeader.classList.add(`sort-${currentSort.direction}`);
                }
            }
            
            rows.sort((a, b) => {
                let aValue = a.querySelector(`td:nth-child(${getColumnIndex(column)})`).textContent.trim();
                let bValue = b.querySelector(`td:nth-child(${getColumnIndex(column)})`).textContent.trim();
                
                if (!isNaN(aValue) && !isNaN(bValue)) {
                    aValue = parseFloat(aValue);
                    bValue = parseFloat(bValue);
                }
                
                if (aValue < bValue) return currentSort.direction === 'asc' ? -1 : 1;
                if (aValue > bValue) return currentSort.direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            tbody.innerHTML = '';
            rows.forEach(row => tbody.appendChild(row));
        }
        
        function getColumnIndex(columnName) {
            const headers = document.querySelectorAll('#courses-table th');
            for (let i = 0; i < headers.length; i++) {
                if (headers[i].getAttribute('data-sort') === columnName) return i + 1;
            }
            return 1;
        }
        
        function showAreaModal() {
            const modal = document.getElementById('area-modal');
            
            // Destruir gr√°fico anterior se existir
            if (areaChart) {
                areaChart.destroy();
            }
            
            // Preparar dados para o gr√°fico
            const areas = Object.keys(areaDistributionData);
            const counts = Object.values(areaDistributionData);
            const total = counts.reduce((acc, count) => acc + count, 0);
            
            // Ordenar as √°reas por contagem (do maior para o menor)
            const sortedIndices = counts.map((count, index) => index).sort((a, b) => counts[b] - counts[a]);
            const sortedAreas = sortedIndices.map(i => areas[i]);
            const sortedCounts = sortedIndices.map(i => counts[i]);
            
            // Criar gr√°fico de barras
            const ctx = document.getElementById('area-chart').getContext('2d');
            areaChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedAreas,
                    datasets: [{
                        label: 'N√∫mero de Cursos',
                        data: sortedCounts,
                        backgroundColor: 'rgba(0, 158, 227, 0.8)',
                        borderColor: 'rgba(0, 158, 227, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantidade de Cursos'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: '√Åreas'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                          display:false
                        }, 
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `Quantidade: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            modal.style.display = 'block';
        }
        
        function showTypeModal() {
            const modal = document.getElementById('type-modal');
            
            // Destruir gr√°fico anterior se existir
            if (typeChart) {
                typeChart.destroy();
            }
            
            const total = Object.values(typeDistributionData).reduce((acc, count) => acc + count, 0);
            
            const ctx = document.getElementById('type-chart').getContext('2d');
            typeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: Object.keys(typeDistributionData),
                    datasets: [{
                        label: 'N√∫mero de Cursos',
                        data: Object.values(typeDistributionData),
                        backgroundColor: [
                            'rgba(0, 158, 227, 0.8)',
                            'rgba(255, 107, 0, 0.8)'
                        ],
                        borderColor: [
                            'rgba(0, 158, 227, 1)',
                            'rgba(255, 107, 0, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantidade de Cursos'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Tipos de Curso'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                          display:false
                        }, 
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `Quantidade: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            modal.style.display = 'block';
        }

        function showRegionModal() {
            const modal = document.getElementById('region-modal');
            
            // Destruir gr√°fico anterior se existir
            if (regionChart) {
                regionChart.destroy();
            }
            
            // Preparar dados para o gr√°fico
            const regions = Object.keys(regionalDistributionData);
            const counts = Object.values(regionalDistributionData);
            const total = counts.reduce((acc, count) => acc + count, 0);
            
            // Ordenar as regi√µes por contagem
            const sortedIndices = counts.map((count, index) => index).sort((a, b) => counts[b] - counts[a]);
            const sortedRegions = sortedIndices.map(i => regions[i]);
            const sortedCounts = sortedIndices.map(i => counts[i]);
            
            // Cores para as regi√µes (usando as mesmas do mapa)
            const regionColors = {
                "Metropolitana": "#e41a1c",
                "Zona da Mata": "#377eb8",
                "Agreste": "#4daf4a",
                "Sert√£o": "#984ea3",
                "V√°rios": "#ff7f00"
            };
            
            const backgroundColors = sortedRegions.map(region => regionColors[region] || '#999999');
            
            // Criar gr√°fico de barras
            const ctx = document.getElementById('region-chart').getContext('2d');
            regionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedRegions,
                    datasets: [{
                        label: 'N√∫mero de Cursos',
                        data: sortedCounts,
                        backgroundColor: backgroundColors,
                        borderColor: backgroundColors,
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantidade de Cursos'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Regi√µes'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                          display:false
                        }, 
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `Quantidade: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            modal.style.display = 'block';
        }

        function showCampusModal() {
            const modal = document.getElementById('campus-modal');
            
            // Destruir gr√°fico anterior se existir
            if (campusChart) {
                campusChart.destroy();
            }
            
            // Preparar dados para o gr√°fico
            const campuses = Object.keys(campusDistributionData);
            const counts = Object.values(campusDistributionData);
            const total = counts.reduce((acc, count) => acc + count, 0);
            
            // Ordenar os campi por contagem (do maior para o menor)
            const sortedIndices = counts.map((count, index) => index).sort((a, b) => counts[b] - counts[a]);
            const sortedCampuses = sortedIndices.map(i => campuses[i]);
            const sortedCounts = sortedIndices.map(i => counts[i]);
            
            // Criar gr√°fico de barras
            const ctx = document.getElementById('campus-chart').getContext('2d');
            campusChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: sortedCampuses,
                    datasets: [{
                        label: 'N√∫mero de Cursos',
                        data: sortedCounts,
                        backgroundColor: 'rgba(255, 107, 0, 0.8)',
                        borderColor: 'rgba(255, 107, 0, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Quantidade de Cursos'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Campi'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                          display:false
                        }, 
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const value = context.raw;
                                    const percentage = ((value / total) * 100).toFixed(1);
                                    return `Quantidade: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
            
            modal.style.display = 'block';
        }
    </script>
</body>
</html>
